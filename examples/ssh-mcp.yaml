# SSH MCP Server Example
#
# This topology demonstrates connecting to MCP servers running on remote machines
# via SSH. SSH servers communicate using stdio transport over an SSH connection.
#
# Use cases:
#   - Running MCP servers on remote machines without exposing ports
#   - Accessing MCP servers through SSH tunnels/bastion hosts
#   - Secure communication with MCP servers over untrusted networks
#   - Connecting to MCP servers that don't have HTTP endpoints
#
# Authentication:
#   By default, SSH uses the SSH agent (SSH_AUTH_SOCK) for authentication.
#   You can optionally specify an identity file path for key-based auth.
#
# Usage:
#   agentlab deploy examples/ssh-mcp.yaml
#
# Note: SSH servers communicate via stdin/stdout over the SSH connection.
# The command specified runs on the remote host and must be an MCP server
# that speaks JSON-RPC over stdio.

version: "1"
name: ssh-mcp-demo

network:
  name: ssh-mcp-net
  driver: bridge

mcp-servers:

  # SSH MCP server with default SSH agent authentication
  # Uses the SSH agent (SSH_AUTH_SOCK) for authentication
  - name: remote-tools
    command: ["/opt/mcp-server/bin/server"]
    ssh:
      host: "192.168.1.50"
      user: "mcp"
      # port: 22  # optional, defaults to 22

  # SSH MCP server with explicit identity file
  # - name: private-server
  #   command: ["python3", "/home/mcp/server.py"]
  #   ssh:
  #     host: "dev.example.com"
  #     user: "deploy"
  #     port: 2222
  #     identityFile: "~/.ssh/id_ed25519"

  # SSH MCP server with environment variables
  # Environment variables are passed to the remote command
  # - name: configured-server
  #   command: ["node", "mcp-server.js"]
  #   ssh:
  #     host: "worker.internal"
  #     user: "app"
  #   env:
  #     LOG_LEVEL: "debug"
  #     CONFIG_PATH: "/etc/mcp/config.json"

# You can mix SSH and other server types in the same topology:
#
# mcp-servers:
#   - name: remote-via-ssh
#     command: ["/usr/bin/mcp-server"]
#     ssh:
#       host: "10.0.0.5"
#       user: "admin"
#
#   - name: local-container
#     image: mcp-tools:latest
#     port: 8080
#     transport: http
#
#   - name: external-api
#     url: https://api.example.com/mcp
#     transport: http
